AWSTemplateFormatVersion: "2010-09-09"
Parameters:
  CreateAWSServiceRoleForEC2Spot:
    Type: String
    Description: Set to 'Yes' to create the service-linked role, 'No' to skip it
    AllowedValues:
      - Yes
      - No
    Default: No

Conditions:
  CreateAWSServiceRoleForEC2Spot:
    Fn::Equals: [ !Ref CreateAWSServiceRoleForEC2Spot, "Yes" ]

Resources:
  AWSServiceRoleForEC2Spot:
    Type: AWS::IAM::ServiceLinkedRole
    Properties:
      AWSServiceName: spot.amazonaws.com
      Description: Create a service-linked role for Karpenter to manage Spot Instances
    Condition: CreateAWSServiceRoleForEC2Spot
